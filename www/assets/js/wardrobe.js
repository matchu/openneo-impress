Array.prototype.removeValue=function(n){n=$.inArray(n,this);n!=-1&&this.splice(n,1)};Array.prototype.clone=function(){return this.splice(0)};Array.prototype.toInt=function(){return $.map(this,function(n){return parseInt(n)})};
var MainWardrobe=new (function(){function n(d){var f=[];$.each(d,function(g,c){$.isArray(c)?$.each(c,function(){f.push(g+"[]="+encodeURIComponent(this))}):f.push(g+"="+encodeURIComponent(c))});return f.join("&")}function q(d,f,g,c){f=f?n(f):"";var i=d+"?"+f;if($.inArray(i,q.requestsLoading)==-1){q.requestsLoading.push(i);$.ajax($.extend(c,{url:d,data:f,dataType:"json",success:g,complete:function(){q.requestsLoading.removeValue(i)}}))}}function y(d){var f;f=o.pet_type.body_id;d.id=parseInt(d.id);d.parent_id=
parseInt(d.parent_id);for(var g in d)this[g]=d[g];this.constructor.cache[this.id]=this;(d=this.constructor.cache_by_body_and_parent_id[f])||(d=this.constructor.cache_by_body_and_parent_id[f]={});(f=d[this.parent_id])||(f=d[this.parent_id]=[]);f.push(this)}function w(d){this.inheritsFrom=y;this.inheritsFrom(d);this.is_body_specific=this.is_body_specific=="1";this.getObject=function(){return k.find(this.parent_id)}}function x(d){this.inheritsFrom=y;this.inheritsFrom(d)}function k(d,f){this.is_placeholder=
f?true:false;this.addToCloset=function(){var c=r.getObjectIds();c.push(this.id);j.set("closet",c)};this.addToOutfit=function(){this.isCloseted()||this.addToCloset();var c=o.getObjectIds();c.push(this.id);j.set("objects",c);o.removeObjectsConflictingWith(this)};this.getAssetsByBodyId=function(c){c=w.cache_by_body_and_parent_id[c];var i;if(c)i=c[this.id];return i?$.extend(true,[],i):[]};this.hasAssetsWithBodyId=function(c){return this.getAssetsByBodyId(c).length>0};this.isAvailable=function(){return!this.isUnavailable()};
this.isCloseted=function(){return $.inArray(this.id,r.getObjectIds())!=-1};this.isUnavailable=function(){return $.inArray(this.id,r.unavailable_object_ids)!=-1};this.isWorn=function(){return this.isAvailable()&&$.inArray(this.id,o.getObjectIds())!=-1};this.removeFromCloset=function(){this.removeFromOutfit();var c=r.getObjectIds();c.removeValue(this.id);j.set("closet",c)};this.removeFromOutfit=function(){var c=o.getObjectIds();c.removeValue(this.id);j.set("objects",c)};d.id=parseInt(d.id);for(var g in d)this[g]=
d[g];k.cache[this.id]=this}q.requestsLoading=[];$.each([w,x],function(){this.cache={};this.find=function(d){d=parseInt(d);return this.cache[d]};this.cache_by_body_and_parent_id={}});k.cache={};k.find=function(d){d=parseInt(d);var f=k.cache[d];f||(f=new k({id:d},true));return f};var r=new (function(){this.unavailable_object_ids=[];this.setUnavailableObjectIds=function(d){this.unavailable_object_ids=d.toInt();m.updateObjectStatuses()};this.clearObjectStatuses=function(){this.unavailable_object_ids=
[]};this.getObjectIds=function(){return j.get("closet")?j.get("closet").toInt():[]};this.getObjects=function(){return $.map(j.get("closet"),function(d){return k.find(d)})};this.initialize=function(){j.get("objects")&&!j.get("closet")&&j.set("closet",j.get("objects"));this.update()};this.update=function(){var d=j.get("closet");if(d){d=$.grep(j.get("closet"),function(f){return k.find(f).is_placeholder});if(d.length){r.clearObjectStatuses();q("/objects.json",{ids:d},function(f){$.each(f,function(){object=
new k(this)});m.modules.closet.update()})}}}}),j=new (function(){function d(){g={};var i=(document.location.hash||document.location.search).substr(1),b=i.split("&");$.each(b,function(){var a=this.split("="),e=decodeURIComponent(a[0]);a=decodeURIComponent(a[1]);var h=e.match(/(.+)\[\]/);if(h){g[h[1]]||(g[h[1]]=[]);g[h[1]].push(a)}else g[e]=a});c=i}function f(i,b){g[i]=b}var g=null,c;this.get=function(i){g||d();return g[i]};this.set=function(i,b){if(typeof i=="object")$.each(i,f);else g[i]=b;document.location.hash=
n(g)};setInterval(function(){if((document.location.hash||document.location.search).substr(1)!=c){d();o.update();r.update()}},100)}),o=new (function(){function d(b,a){$.each(b,function(){new a(this)})}function f(){if(!c.pet_type)return false;var b=x.cache_by_body_and_parent_id[c.pet_type.body_id],a,e=j.get("state");if(b)a=b[e];if(a){c.biology_assets=a;c.setRestrictedZones();m.Outfit.update()}else q("/biology_assets.json",{parent_id:e},function(h){c.biology_assets=h;d(h,x);c.setRestrictedZones();m.Outfit.update()})}
function g(){var b=j.get("species"),a=j.get("color"),e;if(!c.pet_type||b!=c.pet_type.species_id||a!=c.pet_type.color_id){m.Outfit.hideBiologyAssets();q("/pet_types.json",{"for":"wardrobe",species_id:b,color_id:a},function(h){var l=j.get("state");if(h){c.pet_type&&h.body_id!=c.pet_type.body_id&&m.Outfit.removeBodySpecificAssets();h.species_id=b;h.color_id=a;c.pet_type=h;(l=!l||$.inArray(parseInt(l),h.pet_state_ids)==-1)&&j.set("state",h.pet_state_ids[0]);f();m.modules.pet_state.update();c.updateObjects()}else{e=
{title:"Pet not found!"};if(!c.pet_type){e.close=function(){window.location="/"};e.modal=true}m.error("We haven't seen this pet type before. If it's out there, please help us out by <a href='http://beta.impress.openneo.net/pet_types/needed'>helping us find it</a>! Thanks!",e);m.Outfit.showBiologyAssets();if(c.pet_type){j.set({color:c.pet_type.color_id,species:c.pet_type.species_id});m.modules.pet_type.update()}}})}else c.updateObjects()}var c=this,i=[];this.biology_assets=[];this.pet_type=null;this.restricted_zones=
[];this.getAssets=function(){var b=c.biology_assets;$.each(this.getObjectIds(),function(){var a=k.find(this);b=b.concat(a.getAssetsByBodyId(c.pet_type.body_id))});return b};this.getObjectIds=function(){var b=j.get("objects");return b?b.toInt():[]};this.getObjects=function(){return $.map(this.getObjectIds(),function(b){return k.find(b)})};this.removeObjectsConflictingWith=function(b){i.push(b)};this.removeObjectsConflictingWithQueue=function(){$.each(i,function(){var b=this,a=this.getAssetsByBodyId(c.pet_type.body_id);
$.each(a,function(){var e=this;$.each(c.getObjects(),function(){var h;if(b.id!=this.id){h=this.getAssetsByBodyId(c.pet_type.body_id);for(var l in h)h[l].zone_id==e.zone_id&&this.removeFromOutfit()}})})});i=[]};this.setRestrictedZones=function(){var b=this.getObjects().concat(c.biology_assets);this.restricted_zones=[];$.each(b,function(){var a;a=0;if(this.zones_restrict)for(;(a=this.zones_restrict.indexOf("1",a))!=-1;){a=a+1;c.restricted_zones.push(a);a=a}})};this.updateObjects=function(){function b(){var e=
$.grep(a.clone(),function(h){return!k.find(h).hasAssetsWithBodyId(c.pet_type.body_id)});c.setRestrictedZones();c.removeObjectsConflictingWithQueue();r.setUnavailableObjectIds(e);m.Outfit.update()}var a=$.grep(this.getObjectIds(),function(e){return!k.find(e).hasAssetsWithBodyId(c.pet_type.body_id)});a.length?q("/object_assets.json",{parent_ids:a,body_id:c.pet_type.body_id},function(e){d(e,w);b()}):b()};this.updatePetState=function(b){j.set("state",b);f()};this.initialize=this.update=function(){g();
f()}}),B=new (function(){var d=[];this.getObjects=function(){return d};$("#search-form").submit(function(f){f.preventDefault();$("#search-module-error").hide();q("/objects.json",{search:$("#search-form-query").val()},function(g){d=[];$.each(g,function(){d.push(new k(this))});m.modules.search.update()},{error:function(g){$("#search-module-error").text(g.responseText).show();d=[];m.modules.search.update()}})})}),m=this.View=new (function(){function d(b,a){this.afterUpdate=function(){};this.object_owner=
a;this.objects_wrapper_query=b;this.update=function(){var e=$(this.objects_wrapper_query).html("");$.each(this.object_owner.getObjects(),function(){var h=$("<li></li>").attr({id:"object-"+this.id,"class":"object"}).data("object_id",this.id);$("<img />").attr({src:this.thumbnail_url,alt:"",height:80,width:80}).appendTo(h);h.append("<span>"+this.name+"</span>").wrapInner("<div></div>").appendTo(e)});g.updateObjectStatuses();this.afterUpdate()}}function f(){var b={top:null,left:null},a=$(window);available=
{height:a.height()-c.bottom.outerHeight(),width:a.width()-c.right.outerWidth()};$.each(c,function(){this.css(b)});c.right.css("height",null);c.bottom.width(available.width);$("#toolbar-float").css("right",c.right.outerWidth());available.height>available.width?$("#outfit-preview").css({height:available.width,left:null,width:available.width,top:(available.height-available.width)/2}):$("#outfit-preview").css({height:available.height,left:(available.width-available.height)/2,width:available.height,top:null});
g.Outfit.Watermark.update_position();$("#object-description").css({bottom:c.bottom.outerHeight(),right:c.right.outerWidth()})}var g=this;this.Outfit=new (function(){var b=false;this.hideBiologyAssets=function(){};this.removeBodySpecificAssets=function(){$(".body-specific-asset").remove()};this.showBiologyAssets=function(){$(".biology-asset").show()};this.initialize=function(){swfobject.embedSWF("/assets/swf/preview.swf","outfit-preview-swf","100%","100%","9","/assets/js/swfobject/expressInstall.swf",
{swf_assets_path:"/assets"},{wmode:"transparent"})};this.setFlashIsReady=function(){if(b){b=false;g.Outfit.update()}};this.update=function(){var a;if(b)return false;a=$("#outfit-preview-swf").get(0);if(a.setAssets){var e=$.grep(o.getAssets(),function(h){return $.inArray(parseInt(h.zone_id),o.restricted_zones)==-1});a.setAssets(e)}else b=true;this.Watermark.update()};this.Watermark=new (function(){var a=this,e,h={r:[0,0.2],e:[0,0.7],s:[0.5,0.2],t:[0.5,0.7],m:[0.25,0.45]},l=false;this.update=function(){function s(){for(var p=
$("#"+e+"s"),t="",v=0;v<25;v++)t+=String.fromCharCode(Math.random()*26+97);p.length&&p.remove();for(var u in h){p=$("."+e+u);if(p.length)p.attr("class",t+u);else{p=$("<div>The Wardrobe</div>");p.attr("class",t+u).appendTo(document.body)}}e=t;a.update_position()}l?s():$(function(){s();l=true})};this.update_position=function(){function s(){var p=$("#outfit-preview"),t=p.height(),v=p.width(),u=p.offset(),z="";$.each(h,function(C,A){z+="."+e+C+" {opacity: .1; filter:alpha(opacity=30);position: absolute;left: "+
(v*A[0]+u.left)+"px;top: "+(t*A[1]+u.top)+"px;width: "+v/2+"px;color: #fff;font-weight: bold;text-align: center;text-shadow: #000 1px 1px;z-index: 100;}"});$('<style type="text/css">'+z+"</style>").attr("id",e+"s").appendTo("head");$("#outfit-preview").css("zIndex",1)}l?s():$(function(){s();l=true})}})});this.modules=[];this.modules.closet=new d("#closet-module-objects",r);this.modules.pet_state=new (function(){this.update=function(){var b=$("#pet-state-list").html(""),a=0;$.each(o.pet_type.pet_state_ids,
function(){var e=this;$("<a/>",{href:"#",text:"State #"+ ++a,click:function(h){h.preventDefault();o.updatePetState(e)}}).wrap("<li/>").parent().appendTo(b)})}});this.modules.pet_type=new (function(){this.update=function(){$.each(["color","species"],function(){var b=j.get(this);$("#pet-type-form-"+this).children("option").each(function(){var a=$(this);a.val()==b&&a.attr("selected","selected")})})};q("/pet_attributes.json",null,function(b){$.each(b,function(a,e){var h=$("#pet-type-form-"+a);$.each(e,
function(){$('<option value="'+this.id+'">'+this.name+"</option>").appendTo(h)})});g.modules.pet_type.update();$("#pet-type-form").css("visibility","visible")});$("#pet-type-form").submit(function(b){b.preventDefault();var a={};$.each(["species","color"],function(){a[this]=$("#pet-type-form-"+this+" option:selected").val()});j.set(a);o.update()})});this.modules.search=new d("#search-module-objects",B);this.modules.search.afterUpdate=function(){var b=this.object_owner.getObjects(),a=$(this.objects_wrapper_query);
b=a.children(".object:first").outerWidth()*b.length;a.width(b);$("#toolbar-bottom").animate({height:a.outerHeight()+a.position().top},250,f)};this.updateObjectStatuses=function(){$(".object").each(function(){var b=$(this),a=k.find(b.data("object_id"));b.toggleClass("unavailable-object",a.isUnavailable());b.toggleClass("worn-object",a.isWorn())})};var c={},i={ghost:true,stop:f};$.each({bottom:{handles:"n"},right:{handles:"w"}},function(b,a){c[b]=$("#toolbar-"+b).resizable($.extend(i,a))});$(window).resize(f);
f();$(".object").live("mouseenter",function(){var b=$(this),a=$("#object-description");if(!b.children(".object-action").length){var e=k.find(b.data("object_id")),h="",l=function(s){var p=s.toLowerCase();$('<a href="#" class="object-action object-action-'+p+'">'+s+"</a>").appendTo(b)};e.isWorn()?l("Unwear"):l("Wear");e.isCloseted()?l("Uncloset"):l("Closet");if(e.isUnavailable())h='<p class="ui-state-error">We haven\'t seen this body type wearing this item before. If you have, go to the homepage and add the pet, so we can get that data! Thanks!</p>';
a.html("<h1>"+e.name+" ("+[e.rarity,e.rarity_index].join(" - ")+")</h1><p>"+e.description+"</p>"+h+"<dl><dt>Type</dt><dd>"+e.type+"</dd><dt>Est. Price</dt><dd>"+e.price+"</dd></dl>").css("backgroundImage","url("+e.thumbnail_url+")").show()}}).live("mouseleave",function(){$(this).children(".object-action").remove();$("#object-description").hide()});this.error=function(b,a){var e=$("#error-dialog");if(e.length)e.dialog("destroy");else e=$("<div/>",{id:"error-dialog"});e.html(b);e.dialog($.extend({title:"Uh oh! Error!"},
a))};$(".object-action-wear").live("click",function(b){var a=$(this).parent();a=k.find(a.data("object_id"));b.preventDefault();a.addToOutfit();o.updateObjects();g.modules.closet.update()});$(".object-action-unwear").live("click",function(b){var a=$(this).parent();a=k.find(a.data("object_id"));b.preventDefault();a.removeFromOutfit();g.Outfit.update();g.modules.closet.update()});$(".object-action-closet").live("click",function(b){var a=$(this).parent();a=k.find(a.data("object_id"));b.preventDefault();
a.addToCloset();g.modules.closet.update()});$(".object-action-uncloset").live("click",function(b){var a=$(this).parent(),e=k.find(a.data("object_id"));b.preventDefault();a.parents("#closet-module").length&&$("#object-description").hide();e.removeFromCloset();g.Outfit.update();g.modules.closet.update()})});m.Outfit.initialize();o.initialize();r.initialize()}),ef=function(){};function log(n){typeof console!="undefined"&&typeof console.log!="undefined"&&console.log(n)}
function dir(n){typeof console!="undefined"&&typeof console.dir!="undefined"&&console.dir(n)};