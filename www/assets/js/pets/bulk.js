var form=$("#bulk-pets-form"),queue_el=form.find("ul"),names_el=form.find("textarea"),add_el=$("#bulk-pets-form-add"),clear_el=$("#bulk-pets-form-clear"),bulk_load_queue;$(document.body).addClass("js");
bulk_load_queue=new (function(){function e(a){var f=c.clone().children("img").attr("src",petImage("cpn/"+a,1)).end().children("span.name").text(a).end();f.appendTo(queue_el);this.load=function(){var g=f.children("span.response").text("Loading...");$.ajax({complete:function(){b.shift();b.length&&b[0].load()},data:{name:a},dataType:"json",error:function(d){f.addClass("failed");g.text(d.responseText)},success:function(d){d=d===true?"":d+" points";f.addClass("loaded");g.text(d)},type:"post",url:h})}}
var b=[],c=$("<li/>"),h=form.attr("action")+".json";c.append("<img/>").append($("<span/>",{"class":"name"})).append($("<span/>",{"class":"response",text:"Waiting..."}));this.add=function(a){a=a.replace(/^\s+|\s+$/g,"");if(a.length){a=new e(a);b.push(a);b.length==1&&a.load()}}});names_el.keyup(function(){var e=this.value.split("\n"),b=e.length-1,c;for(c=0;c<b;c++)bulk_load_queue.add(e[c]);this.value=b>=0?e[b]:""});add_el.click(function(){bulk_load_queue.add(names_el.val());names_el.val("")});clear_el.click(function(){queue_el.children("li.loaded, li.failed").remove()});