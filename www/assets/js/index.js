function petImage(a,e){return"http://pets.neopets.com/"+a+"/1/"+e+".png"}var preview_el=$("#pet-preview"),img_el=preview_el.find("img"),response_el=preview_el.find("span"),name_el=$("#name");preview_el.click(function(){name_el.val(Preview.Job.current.name).closest("form").submit()});
var Preview={clear:function(){typeof Preview.Job.fallback!="undefined"&&Preview.Job.fallback.setAsCurrent()},displayLoading:function(){preview_el.addClass("loading");response_el.text("Loading...")},notFound:function(a){preview_el.addClass("hidden");response_el.text(a)},updateWithName:function(){var a=name_el.val();if(a){currentName=a;if(a!=Preview.Job.current.name){a=new Preview.Job.Name(a);a.setAsCurrent();Preview.displayLoading()}}else Preview.clear()}};
$.get("/spotlight_pets.txt",function(a){a=a.split("\n");Preview.Job.fallback=new Preview.Job.Name(a[Math.floor(Math.random()*(a.length-1))]);Preview.Job.current||Preview.Job.fallback.setAsCurrent()});Preview.Job=function(a,e){function i(){g.loading=true;img_el.attr("src",petImage(e+"/"+a,b))}var g=this,b=2;g.loading=false;this.increaseQualityIfPossible=function(){if(b==2){b=4;i()}};this.setAsCurrent=function(){Preview.Job.current=g;i()}};
Preview.Job.Name=function(a){this.name=a;Preview.Job.apply(this,[a,"cpn"])};Preview.Job.Hash=function(a){Preview.Job.apply(this,[a,"cp"])};
$(function(){var a,e={};$.each(document.location.search.substr(1).split("&"),function(){var b=this.split("=");if(b.length==2)e[b[0]]=b[1]});if(e.name){name_el.val(e.name);if(e.species&&e.color){var i=$("<div></div>",{"class":"notice",html:"Thanks for showing us <strong>"+e.name+"</strong>! Keep up the good work!"});$("<img/>",{"class":"inline-image",src:petImage("cpn/"+e.name,1)}).prependTo(i);i.prependTo("#container")}}Preview.updateWithName();name_el.keyup(function(){if(a){clearTimeout(a);Preview.Job.current.loading=
false}a=setTimeout(Preview.updateWithName,250)});img_el.load(function(){if(Preview.Job.current.loading){Preview.Job.loading=false;Preview.Job.current.increaseQualityIfPossible();preview_el.removeClass("loading").removeClass("hidden").addClass("loaded");response_el.text(Preview.Job.current.name)}}).error(function(){if(Preview.Job.current.loading){Preview.Job.loading=false;Preview.notFound("Pet not found.")}});var g=$("#species, #color");g.change(function(){var b={},f=[];g.each(function(){var c=$(this),
h=c.children(":selected");b[c.attr("id")]=h.val();f.push(h.text())});f=f.join(" ");Preview.displayLoading();$.ajax({url:"/pet_types.json",data:{"for":"image",species_id:b.species,color_id:b.color},dataType:"json",success:function(c){if(c){c=new Preview.Job.Hash(c.image_hash);c.name=f;c.setAsCurrent()}else Preview.notFound("We haven't seen a "+f+". Have you?")},error:function(){Preview.notFound("Error fetching preview. Try again?")}})});$.getJSON("http://blog.openneo.net/api/read/json?callback=?",
function(b){b=b.posts[0];var f=$("#blog-preview"),c=b["url-with-slug"],h="Here's the latest!",d="",j;if(b.type=="regular"){h=b["regular-title"];d=b["regular-body"]}else if(b.type=="link"){h=b["link-text"];d=b["link-description"]}else if(b.type=="photo"){d=b["photo-caption"];j=b["photo-url-75"]}d=d.replace(/(<\/?[\S][^>]*>)/gi,"");if(d.length>100){d=d.substring(0,100);d=d.replace(/\s+\w+$/,"");d+="&hellip;"}f.find("h4").text(h).wrapInner($("<a/>",{href:c}));f.find("p").html(d);$("<a/>",{id:"read-more",
href:c,text:"read more"}).appendTo(f.find("div"));j&&f.find("img").attr("src",j).parent().attr("href",c)})});