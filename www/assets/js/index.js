$(function(){function g(a){var b=c+2;$("#pet-preview").attr("src","http://pets.neopets.com/"+a+"/1/"+b+".png");d=true}function k(){$("#preview-response").text("Loading...");$("#pet-preview").addClass("loading").data("loadId",++h)}function i(a){$("#preview-response").text(a)}function l(){var a=$("#name").val();if(a){e=a;if(a!=m){k();c=0;g("cpn/"+a)}}else $("#preview-response").text(e);m=a}var j=null,m,h=0,d=false,e,c=0,f=document.location.search.match(/[\?&]name=([^&]+)/);if(f){f=f[1];$("#name").val(f)}l();
$("#name").keyup(function(){if(j){clearTimeout(j);d=false}j=setTimeout(l,250)});$("#pet-preview").load(function(){if(d&&$(this).data("loadId")==h){$(this).removeClass("loading");c+=2;c==2&&g("cpn/"+e);$("#preview-response").text(e)}}).error(function(){d&&$(this).data("loadId")==h&&i("Pet not found.")});var n=$("#species, #color");n.change(function(){var a={};n.each(function(){var b=$(this);a[b.attr("id")]=b.children(":selected").val()});k();$.ajax({url:"/pet_types.json",data:{"for":"image",species_id:a.species,
color_id:a.color},dataType:"json",success:function(b){b?g("cp/"+b.image_hash):i("We don't have data on that yet. If you own or know of a pet of that type, please type its name in above!")},error:function(){i("Error fetching preview. Try again?")}})})});
