function petImage(a,b){return"http://pets.neopets.com/"+a+"/1/"+b+".png"}var Preview={clear:function(){$("#preview-response").text(Preview.Job.current.name)},displayLoading:function(){$("#pet-preview").addClass("loading");$("#preview-response").text("Loading...")},notFound:function(a){$("#pet-preview").addClass("hidden");$("#preview-response").text(a)},updateWithName:function(){var a=$("#name").val();if(a){currentName=a;if(a!=Preview.Job.current.name){a=new Preview.Job.Name(a);a.setAsCurrent();Preview.displayLoading()}}else Preview.clear()}};
Preview.Job=function(a,b){function f(){e.loading=true;$("#pet-preview").attr("src",petImage(b+"/"+a,c))}var e=this,c=2;e.loading=false;this.increaseQualityIfPossible=function(){if(c==2){c=4;f()}};this.setAsCurrent=function(){Preview.Job.current=e;f()}};Preview.Job.Name=function(a){this.name=a;Preview.Job.apply(this,[a,"cpn"])};Preview.Job.Hash=function(a){Preview.Job.apply(this,[a,"cp"])};
$(function(){var a;Preview.Job.current={name:$("#preview-response").text()};var b={};$.each(document.location.search.substr(1).split("&"),function(){var c=this.split("=");if(c.length==2)b[c[0]]=c[1]});if(b.name){$("#name").val(b.name);if(b.species&&b.color){var f=$("<div></div>",{"class":"notice",html:"Thanks for showing us <strong>"+b.name+"</strong>! Keep up the good work!"});$("<img/>",{"class":"inline-image",src:petImage("cpn/"+b.name,1)}).prependTo(f);f.prependTo("#container")}}Preview.updateWithName();
$("#name").keyup(function(){if(a){clearTimeout(a);Preview.Job.current.loading=false}a=setTimeout(Preview.updateWithName,250)});$("#pet-preview").load(function(){if(Preview.Job.current.loading){Preview.Job.loading=false;Preview.Job.current.increaseQualityIfPossible();$(this).removeClass("loading").removeClass("hidden");$("#preview-response").text(Preview.Job.current.name)}}).error(function(){if(Preview.Job.current.loading){Preview.Job.loading=false;Preview.notFound("Pet not found.")}});var e=$("#species, #color");
e.change(function(){var c={},g=[];e.each(function(){var d=$(this),h=d.children(":selected");c[d.attr("id")]=h.val();g.push(h.text())});g=g.join(" ");Preview.displayLoading();$.ajax({url:"/pet_types.json",data:{"for":"image",species_id:c.species,color_id:c.color},dataType:"json",success:function(d){if(d){d=new Preview.Job.Hash(d.image_hash);d.name=g;d.setAsCurrent()}else Preview.notFound("We haven't seen a "+g+". Have you?")},error:function(){Preview.notFound("Error fetching preview. Try again?")}})})});
