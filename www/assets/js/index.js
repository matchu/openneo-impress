var Preview={clear:function(){$("#preview-response").text(Preview.Job.current.name)},displayLoading:function(){$("#pet-preview").addClass("loading");$("#preview-response").text("Loading...")},notFound:function(a){$("#pet-preview").addClass("hidden");$("#preview-response").text(a)},updateWithName:function(){var a=$("#name").val();if(a){currentName=a;if(a!=Preview.Job.current.name){a=new Preview.Job.Name(a);a.setAsCurrent();Preview.displayLoading()}}else Preview.clear()}};
Preview.Job=function(a,e){function f(){d.loading=true;$("#pet-preview").attr("src","http://pets.neopets.com/"+e+"/"+a+"/1/"+b+".png")}var d=this,b=2;d.loading=false;this.increaseQualityIfPossible=function(){if(b==2){b=4;f()}};this.setAsCurrent=function(){Preview.Job.current=d;f()}};Preview.Job.Name=function(a){this.name=a;Preview.Job.apply(this,[a,"cpn"])};Preview.Job.Hash=function(a){Preview.Job.apply(this,[a,"cp"])};
$(function(){var a;Preview.Job.current={name:$("#preview-response").text()};var e=document.location.search.match(/[\?&]name=([^&]+)/);if(e){e=e[1];$("#name").val(e)}Preview.updateWithName();$("#name").keyup(function(){if(a){clearTimeout(a);Preview.Job.current.loading=false}a=setTimeout(Preview.updateWithName,250)});$("#pet-preview").load(function(){if(Preview.Job.current.loading){Preview.Job.loading=false;Preview.Job.current.increaseQualityIfPossible();$(this).removeClass("loading").removeClass("hidden");
$("#preview-response").text(Preview.Job.current.name)}}).error(function(){if(Preview.Job.current.loading){Preview.Job.loading=false;Preview.notFound("Pet not found.")}});var f=$("#species, #color");f.change(function(){var d={},b=[];f.each(function(){var c=$(this),g=c.children(":selected");d[c.attr("id")]=g.val();b.push(g.text())});b=b.join(" ");Preview.displayLoading();$.ajax({url:"/pet_types.json",data:{"for":"image",species_id:d.species,color_id:d.color},dataType:"json",success:function(c){if(c){c=
new Preview.Job.Hash(c.image_hash);c.name=b;c.setAsCurrent()}else Preview.notFound("We haven't seen a "+b+". Have you?")},error:function(){Preview.notFound("Error fetching preview. Try again?")}})})});
