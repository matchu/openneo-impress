(function(){var g=$("#pet-preview"),m=g.find("img"),k=g.find("span"),i=$("#name");g.click(function(){i.val(a.Job.current.name).closest("form").submit()});var a={clear:function(){typeof a.Job.fallback!="undefined"&&a.Job.fallback.setAsCurrent()},displayLoading:function(){g.addClass("loading");k.text("Loading...")},notFound:function(b){g.addClass("hidden");k.text(b)},updateWithName:function(){var b=i.val();if(b){currentName=b;if(!a.Job.current||b!=a.Job.current.name){b=new a.Job.Name(b);b.setAsCurrent();
a.displayLoading()}}else a.clear()}};$.get("/spotlight_pets.txt",function(b){b=b.split("\n");a.Job.fallback=new a.Job.Name(b[Math.floor(Math.random()*(b.length-1))]);a.Job.current||a.Job.fallback.setAsCurrent()});a.Job=function(b,j){function c(){e.loading=true;m.attr("src",petImage(j+"/"+b,d))}var e=this,d=2;e.loading=false;this.increaseQualityIfPossible=function(){if(d==2){d=4;c()}};this.setAsCurrent=function(){a.Job.current=e;c()}};a.Job.Name=function(b){this.name=b;a.Job.apply(this,[b,"cpn"])};
a.Job.Hash=function(b){a.Job.apply(this,[b,"cp"])};$(function(){var b;i.val(PetQuery.name);a.updateWithName();i.keyup(function(){if(b){clearTimeout(b);a.Job.current.loading=false}b=setTimeout(a.updateWithName,250)});m.load(function(){if(a.Job.current.loading){a.Job.loading=false;a.Job.current.increaseQualityIfPossible();g.removeClass("loading").removeClass("hidden").addClass("loaded");k.text(a.Job.current.name)}}).error(function(){if(a.Job.current.loading){a.Job.loading=false;a.notFound("Pet not found.")}});
var j=$("#species, #color");j.change(function(){var c={},e=[];j.each(function(){var d=$(this),h=d.children(":selected");c[d.attr("id")]=h.val();e.push(h.text())});e=e.join(" ");a.displayLoading();$.ajax({url:"/pet_types.json",data:{"for":"image",species_id:c.species,color_id:c.color},dataType:"json",success:function(d){if(d){d=new a.Job.Hash(d.image_hash);d.name=e;d.setAsCurrent()}else a.notFound("We haven't seen a "+e+". Have you?")},error:function(){a.notFound("Error fetching preview. Try again?")}})});
$.getJSON("http://blog.openneo.net/api/read/json?callback=?",function(c){c=c.posts[0];var e=$("#blog-preview"),d=c["url-with-slug"],h="Here's the latest!",f="",l;if(c.type=="regular"){h=c["regular-title"];f=c["regular-body"]}else if(c.type=="link"){h=c["link-text"];f=c["link-description"]}else if(c.type=="photo"){f=c["photo-caption"];l=c["photo-url-75"]}f=f.replace(/(<\/?[\S][^>]*>)/gi,"");if(f.length>100){f=f.substring(0,100);f=f.replace(/\s+\w+$/,"");f+="&hellip;"}e.find("h4").text(h).wrapInner($("<a/>",
{href:d}));e.find("p").html(f);$("<a/>",{id:"read-more",href:d,text:"read more"}).appendTo(e.find("div"));l&&e.find("img").attr("src",l).parent().attr("href",d);e.children("div").hide().fadeIn("slow")})})})();